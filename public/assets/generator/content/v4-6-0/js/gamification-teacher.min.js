!function(){const n=io(),i=window.location.pathname.split("/")[1],s=i+"-studentlist",o="indie-asignedstudentlist";let a=JSON.parse(sessionStorage.getItem(s))||{};n.emit("join-room",i);let r=function(e){if(0===Object.keys(e).length)return[];let t=Object.keys(e).map(t=>e[t]);t.sort((t,e)=>t.time-e.time);var n=t.filter(t=>1===t.score);let s=(0<n.length?n:t)[0].time,o=t[t.length-1].time,i=t.map((t,e,n)=>{let i={...t};i.points=1e3*i.score;t=s===o?0:.2*i.points*(Math.max(0,i.time-s)/(o-s));return i.points=Math.round(i.points-t),i});return i.sort((t,e)=>e.points-t.points),i};n.on("update-user-list",t=>{var e=t.id,t={id:e,res:t.res,username:t.username,time:t.time,score:t.score};a[e]=t,sessionStorage.setItem(s,JSON.stringify(a)),$("#student-count").html(Object.keys(a).length)});const l=`
        <div class="gamification-participants">
            <div id="student-count" class="student-circle">0</div>
            <button type="button" id="student-list-button"
                aria-label="Display the student list"
                class="btn btn-dark rounded-0 text-white pr-3 pl-3"
                data-toggle="popover" data-trigger="focus" data-placement="left">
                <i class="fas fa-user fa-3x" aria-hidden="true"></i>
            </button>
        </div>
        <div class="gamification-close">
            <button type="button" id="bgam-${i}" aria-label="Finish game"
                    class="btn btn-dark rounded-0 text-white pr-3 pl-3 pb-2 pt-2">
            <i class="fas fa-trophy fa-2x fa-fw" aria-hidden="true"></i>
            </button>
        </div>`;function d(t,e){$("#showcodgane").append("https://game.upct.es/"+i+"/"),$("#student-count").html(Object.keys(a).length),$("#body").height($(document).height()),$("#student-list-div").html(l),$("#student-list-button").popover({trigger:"focus",html:!0,content:function(){let t=$("<div />").attr("id","student-list").addClass("list-group list-group-flush border-bottom scrollarea");for(var e in a)t.append($("<div />").addClass("list-group-item list-group-item-action py-3 lh-tight").append($("<strong />").addClass("mb-1").html(a[e].username)));return t}}),$("#student-count").html(Object.keys(a).length),$(document).on("click","#bgam-"+i,function(){$("#modalConfirmacion").modal("show")}),$("#modal-btn-si").on("click",function(){var t;t=r(a),sessionStorage.setItem(o,JSON.stringify(t)),n.emit("game-finished",{student_list:t,room:i}),window.location.replace("/ranking/?cod="+i),$("#modalConfirmacion").modal("hide")}),$("#modal-btn-no").on("click",function(){$("#modalConfirmacion").modal("hide")})}let t=document.currentScript.src;t=t.substr(0,t.lastIndexOf("/")),$(document).ready(function(){let e=$("html").attr("lang");fetch(`${t}/../languages/${e}.json`).then(t=>t.json()).then(t=>i18next.createInstance({lng:e,resources:{[e]:{translation:t}}},d))})}();